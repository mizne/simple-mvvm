{"version":3,"sources":["webpack:///webpack/universalModuleDefinition","webpack:///webpack/bootstrap c53f2c17df260e846d0f","webpack:///./src/core/Watcher.ts","webpack:///./src/core/Observer.ts","webpack:///./src/index.ts","webpack:///./src/core/MVVM.ts","webpack:///./src/core/Compiler.ts"],"names":["root","factory","exports","module","define","amd","this","__webpack_require__","moduleId","installedModules","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","configurable","enumerable","get","n","__esModule","object","property","prototype","hasOwnProperty","p","s","Watcher","vm","expOrFn","cb","deps","parseGetter","value","update","oldValue","newValue","addDep","dep","id","addWatcher","__WEBPACK_IMPORTED_MODULE_0__Observer__","target","exp","test","exps","split","obj","length","__webpack_exports__","Dep","Observer","data","observer","path","_this","keys","forEach","key","defineReactive","newPath","concat","set","newV","console","log","join","notify","watchers","watcher","push","removeWatcher","index","indexOf","splice","__WEBPACK_IMPORTED_MODULE_0__core_MVVM__","el","greet","showText","a","b","methods","toggleShow","MVVM","options","$options","_data","_proxyData","__WEBPACK_IMPORTED_MODULE_1__Observer__","$compile","__WEBPACK_IMPORTED_MODULE_2__Compiler__","document","body","$watch","__WEBPACK_IMPORTED_MODULE_0__Watcher__","Compile","$vm","$el","querySelector","$fragment","node2Fragment","init","appendChild","child","fragment","createDocumentFragment","firstChild","compileNode","childNodes","reg","Array","from","node","isElement","compileElement","isTextNode","textContent","compileText","RegExp","$1","attrs","attributes","attr","isDirective","dir","substring","isEventDirective","Compiles","eventHandler","removeAttribute","nodeType","textDir","updaters","textUpdater","ifUpdater","style","display","bind","ifDir","updaterFn","getVmVal","oldV","eventType","fn","addEventListener","val","k"],"mappings":"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","file":"mvvm.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"MVVM\"] = factory();\n\telse\n\t\troot[\"MVVM\"] = factory();\n})(this, function() {\nreturn \n\n\n// WEBPACK FOOTER //\n// webpack/universalModuleDefinition"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 2);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap c53f2c17df260e846d0f","import { Dep } from './Observer'\r\nimport MVVM from './MVVM'\r\n\r\nexport default class Watcher {\r\n  private vm: MVVM\r\n  private expOrFn: string | Function\r\n  private cb: Function\r\n  private deps: { [key: string]: Dep }\r\n\r\n  private getter: Function\r\n  private value: any\r\n  constructor(vm: MVVM, expOrFn: string | Function, cb: Function) {\r\n    this.vm = vm\r\n    this.expOrFn = expOrFn\r\n    this.cb = cb\r\n    this.deps = { }\r\n\r\n    if (typeof expOrFn === 'function') {\r\n      this.getter = expOrFn\r\n    } else {\r\n      this.getter = this.parseGetter(expOrFn)\r\n    }\r\n\r\n    this.value = this.get()\r\n  }\r\n\r\n  update() {\r\n    const oldValue = this.value\r\n    const newValue = this.get()\r\n\r\n    if (newValue !== oldValue) {\r\n      this.value = newValue\r\n      this.cb.call(this.vm, newValue, oldValue)\r\n    }\r\n  }\r\n\r\n  addDep(dep: Dep) {\r\n    if (!this.deps.hasOwnProperty(dep.id)) {\r\n      dep.addWatcher(this)\r\n      this.deps[dep.id] = dep\r\n    }\r\n  }\r\n\r\n  get() {\r\n    Dep.target = this\r\n    const value = this.getter.call(this.vm, this.vm)\r\n    Dep.target = null\r\n    return value\r\n  }\r\n\r\n  parseGetter(exp: string) {\r\n    if (/[^\\w.$]/.test(exp)) {\r\n      return \r\n    }\r\n\r\n    const exps = exp.split('.')\r\n    return function (obj: any) {\r\n      for (let i = 0; i < exps.length; i += 1) {\r\n        if (!obj) {return}\r\n        obj = obj[exps[i]]\r\n      }\r\n\r\n      return obj\r\n    }\r\n  }\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/core/Watcher.ts","import Watcher from './Watcher'\r\n\r\nexport class Observer {\r\n  private data: any\r\n  constructor(data: any) {\r\n    this.data = data\r\n    this.observer(data)\r\n  }\r\n\r\n  observer(data: any, path: string[] = []): void {\r\n    if (!data || typeof data !== 'object') {\r\n      return\r\n    }\r\n    Object.keys(data).forEach(key => {\r\n      this.defineReactive(data, key, data[key], path)\r\n    })\r\n  }\r\n\r\n  defineReactive(data: any, key: string, value: any, path: string[]) {\r\n    const newPath = path.concat(key)\r\n    let dep: Dep\r\n    this.observer(value, newPath)\r\n\r\n    Object.defineProperty(data, key, {\r\n      enumerable: true,\r\n      configurable: false,\r\n      get: function() {\r\n        if (Dep.target) {\r\n          dep = dep || new Dep()\r\n          Dep.target.addDep(dep)\r\n        }\r\n        return value\r\n      },\r\n      set: function(newV) {\r\n        console.log(`watch value change; ${value} => ${newV}`)\r\n        console.log('change paths: ' + newPath.join(' => '))\r\n        value = newV\r\n\r\n        new Observer(newV)\r\n        dep && dep.notify()\r\n      }\r\n    })\r\n  }\r\n}\r\n\r\nlet id = 0\r\n\r\nexport class Dep {\r\n  public id: number\r\n  private watchers: Watcher[]\r\n  static target: Watcher | null\r\n  constructor() {\r\n    this.id = id++\r\n    console.log(id)\r\n    this.watchers = []\r\n  }\r\n\r\n  addWatcher(watcher: Watcher) {\r\n    this.watchers.push(watcher)\r\n  }\r\n\r\n  removeWatcher(watcher: Watcher) {\r\n    const index = this.watchers.indexOf(watcher)\r\n    if (index !== -1) {\r\n      this.watchers.splice(index, 1)\r\n    }\r\n  }\r\n\r\n  notify() {\r\n    this.watchers.forEach((watcher) => {\r\n      watcher.update()\r\n    })\r\n  }\r\n}\r\n\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/core/Observer.ts","import MVVM from './core/MVVM'\r\n\r\nexport { MVVM }\r\n\r\nconst vm: any = new MVVM({\r\n  el: 'body',\r\n  data: {\r\n    greet: 'hello',\r\n    showText: true,\r\n    test: {\r\n      a: {\r\n        b: {\r\n          c: '11'\r\n        }\r\n      }\r\n    }\r\n  },\r\n  methods: {\r\n    toggleShow() {\r\n      this.showText = !this.showText\r\n    }\r\n  }\r\n})\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/index.ts","import Watcher from './Watcher'\r\nimport { Observer } from './Observer'\r\nimport Compile from './Compiler'\r\n\r\nexport default class MVVM {\r\n  public $options: any\r\n  private _data: any\r\n  private $compile: Compile\r\n\r\n  constructor(options: any) {\r\n    this.$options = options || {}\r\n    const data = (this._data = this.$options.data)\r\n\r\n    Object.keys(data).forEach(key => {\r\n      this._proxyData(key)\r\n    })\r\n\r\n    new Observer(data)\r\n\r\n    this.$compile = new Compile(options.el || document.body, this)\r\n  }\r\n\r\n  $watch(key: string, cb: Function, options: any) {\r\n    const watcher = new Watcher(this, key, cb)\r\n    // console.log(watcher)\r\n  }\r\n\r\n  _proxyData(key: string) {\r\n    Object.defineProperty(this, key, {\r\n      enumerable: true,\r\n      configurable: false,\r\n      get: () => {\r\n        return this._data[key]\r\n      },\r\n      set: newV => {\r\n        this._data[key] = newV\r\n      }\r\n    })\r\n  }\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/core/MVVM.ts","import Watcher from './Watcher'\r\nimport MVVM from './MVVM'\r\n\r\nexport default class Compile {\r\n  private $el: Node\r\n  private $vm: MVVM\r\n  private $fragment: DocumentFragment\r\n  constructor(el: Node | string, vm: MVVM) {\r\n    this.$vm = vm\r\n    this.$el = typeof el === 'string' ? document.querySelector(el) : el\r\n    if (this.$el) {\r\n      this.$fragment = this.node2Fragment(this.$el)\r\n      this.init()\r\n      this.$el.appendChild(this.$fragment)\r\n    }\r\n  }\r\n\r\n  node2Fragment(el: Node): DocumentFragment {\r\n    const fragment = document.createDocumentFragment()\r\n    let child\r\n\r\n    while ((child = el.firstChild)) {\r\n      fragment.appendChild(child)\r\n    }\r\n    return fragment\r\n  }\r\n\r\n  init() {\r\n    this.compileNode(this.$fragment)\r\n  }\r\n  compileNode(el: Node) {\r\n    const childNodes = el.childNodes\r\n    const reg = /\\{\\{(.*)\\}\\}/\r\n\r\n    Array.from(childNodes).forEach(node => {\r\n      if (this.isElement(node)) {\r\n        this.compileElement(node as Element)\r\n      } else if (this.isTextNode(node) && reg.test(node.textContent)) {\r\n        this.compileText(node, RegExp.$1)\r\n      }\r\n\r\n      if (node.childNodes && node.childNodes.length) {\r\n        this.compileNode(node)\r\n      }\r\n    })\r\n  }\r\n  compileElement(el: Element) {\r\n    const attrs = el.attributes\r\n\r\n    Array.from(attrs).forEach(attr => {\r\n      const name = attr.name\r\n      if (this.isDirective(name)) {\r\n        const exp = attr.value\r\n        const dir = name.substring(2)\r\n\r\n        if (this.isEventDirective(dir)) {\r\n          Compiles.eventHandler(el, this.$vm, exp, dir)\r\n        } else {\r\n          Compiles[dir + 'Dir'] && Compiles[dir + 'Dir'](el, this.$vm, exp)\r\n        }\r\n        el.removeAttribute(name)\r\n      }\r\n    })\r\n  }\r\n\r\n  isElement(node: Node) {\r\n    return node.nodeType === 1\r\n  }\r\n\r\n  isTextNode(node: Node) {\r\n    return node.nodeType === 3\r\n  }\r\n\r\n  isDirective(attr: string) {\r\n    return attr.indexOf('v-') === 0\r\n  }\r\n\r\n  isEventDirective(attr: string) {\r\n    return attr.indexOf('on') === 0\r\n  }\r\n\r\n  compileText(node: Node, exp: string) {\r\n    Compiles.textDir(node, this.$vm, exp)\r\n  }\r\n}\r\n\r\nconst updaters: {\r\n  [key: string]: Function\r\n} = {\r\n  textUpdater(node: Node, value: any) {\r\n    node.textContent = typeof value === 'undefined' ? '' : value\r\n  },\r\n  ifUpdater(node: Node, value: any) {\r\n    ;(node as HTMLElement).style.display = value ? 'block' : 'none'\r\n  }\r\n}\r\n\r\nconst Compiles: { [key: string]: Function } = {\r\n  textDir(node: Node, vm: MVVM, exp: string) {\r\n    Compiles.bind(node, vm, exp, 'text')\r\n  },\r\n  ifDir(node: Node, vm: MVVM, exp: string) {\r\n    Compiles.bind(node, vm, exp, 'if')\r\n  },\r\n\r\n  bind(node: Node, vm: MVVM, exp: string, dir?: string) {\r\n    const updaterFn = updaters[dir + 'Updater']\r\n\r\n    updaterFn && updaterFn(node, Compiles.getVmVal(vm, exp))\r\n\r\n    new Watcher(vm, exp, function(newV: any, oldV: any) {\r\n      updaterFn && updaterFn(node, newV, oldV)\r\n    })\r\n  },\r\n  eventHandler(node: Node, vm: MVVM, exp: string, dir: string) {\r\n    const eventType = dir.split(':')[1]\r\n    const fn = vm.$options.methods && vm.$options.methods[exp]\r\n\r\n    if (eventType && fn) {\r\n      node.addEventListener(eventType, fn.bind(vm), false)\r\n    }\r\n  },\r\n  getVmVal(vm: any, exp: string) {\r\n    let val = vm\r\n    const exps = exp.split('.')\r\n    exps.forEach(k => {\r\n      val = val[k]\r\n    })\r\n    return val\r\n  }\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/core/Compiler.ts"],"sourceRoot":""}